---
title: "LSMS_ADMIN3"
author: "MG"
date: "6/29/2022"
output: html_document
---

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(dplyr)
library(readxl)
library(leaflet)
library(sf)
```

Reading LSMS data provided by Dr.Benami
```{r}
LSMSdata <-read.csv("C:/Users/Milind Gupta/Desktop/2022_DSPG_SAHEL/2022_DSPG_Sahel/nigerlsms_11_14_18_slim.csv")
```

Reading admin2 shape file
```{r}
Niger_level3 <- st_read(
  "C:/Users/Milind Gupta/Desktop/dspg-sahel/Level 3_new/NER_adm03_feb2018.shp")
ggplot() + 
  geom_sf(data = Niger_level3, size = 1, color = "black", fill = "cyan1") + 
  ggtitle("Niger_level3") + 
  coord_sf()
```

spatial data combining latitudes and longitudes
```{r}
lsms_sf <- st_as_sf(LSMSdata, coords=c("longitude","latitude"), crs="WGS84",na.fail=FALSE)
```

```{r}
lsms_median<-lsms_sf%>%group_by(cluster,year)%>% mutate(median_totalexpend=median(pcexp),median_foodexpend=median(pcexp_food),
                                                           median_nonfoodexp=median(pcexp_nonfood))%>%
   distinct(median_foodexpend,.keep_all = TRUE)%>%ungroup()
```

```{r}
lsms_spatialjoin<-st_join(Niger_level3,lsms_median,left=FALSE)
```

```{r}
ggplot() + geom_sf(data=Niger_level3,color="NA")+
  geom_sf(data = lsms_spatialjoin, size = 1, color = "NA", aes(fill=median_foodexpend),alpha=0.5) + 
  labs(title = "Per Capita Food Expenditure by Commune (admin3) ", 
caption = "Gray indicates missing values") + 
  coord_sf()+
   scale_fill_viridis(name="Food Expenditure")+
  theme_classic()+
  facet_wrap(~year)
```

```{r}
ggplot() + geom_sf(data=Niger_level3,color="NA")+
  geom_sf(data = lsms_spatialjoin, size = 1, color = "NA", aes(fill=median_nonfoodexp),alpha=0.5) + 
  labs(title = "Per Capita Non-Food Expenditure by Commune (admin3) ", 
caption = "Gray indicates missing values") + 
  coord_sf()+
   scale_fill_viridis(name="Non-Food Expenditure")+
  theme_classic()+
  facet_wrap(~year)
```

```{r}
ggplot() + geom_sf(data=Niger_level3,color="NA")+
  geom_sf(data = lsms_spatialjoin, size = 1, color = "NA", aes(fill=median_totalexpend),alpha=0.5) + 
  labs(title = "Per Capita Total Expenditure by Commune (admin3) ", 
caption = "Gray indicates missing values") + 
  coord_sf()+
   scale_fill_viridis(name="Total Expenditure")+
  theme_classic()+
  facet_wrap(~year)
```